import{useRouteLocale as q,usePageData as O}from"@vuepress/client";import{isPlainObject as T,isString as W}from"@vuepress/shared";import{useLocalStorage as B,useDebounceFn as M,useEventListener as N}from"@vueuse/core";import{ref as g,watch as I,defineComponent as z,toRef as G,computed as k,h as t}from"vue";import{useRouter as J,RouterLink as V}from"vue-router";import{useLocaleConfig as K}from"vuepress-shared/client";import{s as E,a as X,u as Y,H as Z,C as ee,S as te,T as ae,b as se,c as re,d as le}from"../queryHistory-0b48a016.js";import"../styles/search-result.scss";const ue="search-pro-result-history",n=B(ue,[]),oe=()=>{const{resultHistoryCount:l}=E,c=l>0;return{enabled:c,resultHistory:n,addResultHistory:r=>{c&&(n.value.length<l?n.value=[r,...n.value]:n.value=[r,...n.value.slice(0,l-1)])},removeResultHistory:r=>{n.value=[...n.value.slice(0,r),...n.value.slice(r+1)]}}},ne=l=>{const c=q(),r=g(!1),h=g([]);let i;const v=M(d=>{r.value=!0,i==null||i.terminate(),d?(i=new Worker(__VUEPRESS_DEV__?new URL("../worker/index.js",import.meta.url):`${__VUEPRESS_BASE__}${E.worker}`,__VUEPRESS_DEV__?{type:"module"}:{}),i.addEventListener("message",({data:f})=>{h.value=f,r.value=!1}),i.postMessage({query:d,routeLocale:c.value})):(h.value=[],r.value=!1)},E.delay);return I([l,c],()=>v(l.value),{immediate:!0}),{searching:r,results:h}};var ce=z({name:"SearchResult",props:{query:{type:String,required:!0}},emits:["close","updateQuery"],setup(l,{emit:c}){const r=O(),h=J(),i=q(),v=K(X),{addQueryHistory:d}=Y(),{enabled:f,resultHistory:C,addResultHistory:L,removeResultHistory:$}=oe(),S=G(l,"query"),{results:m,searching:Q}=ne(S),u=g(0),s=g(0),w=k(()=>C.value.length>0),R=k(()=>m.value.length>0),H=k(()=>m.value[u.value]||null),U=()=>{u.value=u.value>0?u.value-1:m.value.length-1,s.value=H.value.contents.length-1},A=()=>{u.value=u.value<m.value.length-1?u.value+1:0,s.value=0},x=()=>{s.value<H.value.contents.length-1?s.value=s.value+1:A()},j=()=>{s.value>0?s.value=s.value-1:U()},P=e=>e.map(a=>W(a)?a:t(a[0],a[1])),D=e=>{if(e.type==="custom"){const a=le[e.index]||"$content",[p,y=""]=T(a)?a[i.value].split("$content"):a.split("$content");return P([p,...e.display,y])}return P(e.display)},_=()=>{u.value=0,s.value=0,c("updateQuery",""),c("close")};return N("keydown",e=>{if(R.value){if(e.key==="ArrowUp")j();else if(e.key==="ArrowDown")x();else if(e.key==="Enter"){const a=H.value.contents[s.value];r.value.path!==a.path&&(d(l.query),L(a),h.push(a.path),_())}}}),I([u,s],()=>{var e;(e=document.querySelector(".search-pro-result-list-item.active .search-pro-result-item.active"))==null||e.scrollIntoView(!1)},{flush:"post"}),()=>t("div",{class:["search-pro-result",{empty:S.value?!R.value:!w.value}],id:"search-pro-results"},S.value===""?w.value?t("ul",{class:"search-pro-result-list"},t("li",{class:"search-pro-result-list-item"},[t("div",{class:"search-pro-result-title"},v.value.history),C.value.map((e,a)=>t(V,{to:e.path,class:["search-pro-result-item",{active:s.value===a}],onClick:()=>{_()}},()=>[t(Z,{class:"search-pro-result-type"}),t("div",{class:"search-pro-result-content"},[e.type==="content"&&e.header?t("div",{class:"content-header"},e.header):null,t("div",D(e))]),t("button",{class:"search-pro-close-icon",onClick:p=>{p.preventDefault(),p.stopPropagation(),$(a)}},t(ee))]))])):f?v.value.emptyHistory:v.value.emptyResult:Q.value?t(te,{hint:v.value.searching}):R.value?t("ul",{class:"search-pro-result-list"},m.value.map(({title:e,contents:a},p)=>{const y=u.value===p;return t("li",{class:["search-pro-result-list-item",{active:y}]},[t("div",{class:"search-pro-result-title"},e||"Documentation"),a.map((o,F)=>{const b=y&&s.value===F;return t(V,{to:o.path,class:["search-pro-result-item",{active:b,"aria-selected":b}],onClick:()=>{d(l.query),L(o),_()}},()=>[o.type==="content"?null:t(o.type==="title"?ae:o.type==="heading"?se:re,{class:"search-pro-result-type"}),t("div",{class:"search-pro-result-content"},[o.type==="content"&&o.header?t("div",{class:"content-header"},o.header):null,t("div",D(o))])])})])})):v.value.emptyResult)}});export{ce as default};
//# sourceMappingURL=SearchResult.js.map
