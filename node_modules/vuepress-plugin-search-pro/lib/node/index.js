import{watch as O}from"chokidar";import{useSassPalettePlugin as A}from"vuepress-plugin-sass-palette";import{Logger as $,getPageExcerpt as j,fromEntries as v,keys as x,utoa as f,checkVersion as q,getLocales as I,addViteSsrNoExternal as T}from"vuepress-shared/node";import{getDirname as D,path as w,colors as S,fs as b}from"@vuepress/utils";import{ensureEndingSlash as E,isArray as M}from"@vuepress/shared";import{load as F}from"cheerio";const _=D(import.meta.url),C=E(w.resolve(_,"../client/")),K=E(w.resolve(_,"../worker/")),m="vuepress-plugin-search-pro",P=new $(m),U=({options:e,deprecatedOption:i,newOption:n,msg:a="",scope:t=""})=>{if(i in e){if(P.warn(`${S.magenta(i)} is ${S.yellow("deprecated")}${t?` in ${t}`:""}, please use "${S.magenta(n)}" instead.${a?`
${a}`:""}`),n.includes(".")){const l=n.split(".");let s=e;l.forEach((r,c)=>{c!==l.length-1?(s[r]=s[r]||{},s=s[r]):s[r]=e[i]})}else e[n]=e[i];delete e[i]}},V=e=>{U({options:e,deprecatedOption:"historyCount",newOption:"resultHistoryCount"})},Z=e=>{const{pages:i,pluginApi:n}=e;n.plugins.some(({name:a})=>a==="vuepress-plugin-blog2")||i.some(a=>"excerpt"in a.data)||i.forEach(a=>{a.data.excerpt=j(e,a,{excerptLength:0})})},B="h2,h3,h4,h5,h6".split(","),J="header,nav,section,div,dd,dl,dt,figcaption,figure,picture,hr,li,main,ol,p,ul,caption,table,thead,tbody,th,tr,td,datalist,fieldset,form,legend,optgroup,option,select,details,dialog,menu,menuitem,summary,blockquote,tfoot".split(","),W="routerlink,a,b,abbr,bdi,bdo,cite,code,dfn,em,i,kbd,mark,q,rp,rt,ruby,s,samp,small,span,strong,sub,sup,time,u,var,wbr,del,ins,button,label,legend,meter,optgroup,option,output,progress,select".split(","),G=F(""),z=(e,i=[],n=!1)=>{const a="excerpt"in e.data&&e.data.excerpt.length,t={title:e.title,contents:[]};let l=a||n,s="",r={header:"",slug:"",contents:[]},c=!0;const d=o=>{if(o.type==="tag")if(B.includes(o.name)){s&&l&&(r==null||r.contents.push(s.replace(/\s+/gu," ")),s=""),c?(r.contents.length&&t.contents.push(r),c=!1):t.contents.push(r);const g=p=>p.children.map(u=>u.type==="tag"?u.name==="a"&&u.attribs.class==="header-anchor"?"":g(u):u.type==="text"?u.data:"").join(" ").replace(/\s+/gu," ").trim();r={header:g(o),slug:o.attribs.id,contents:[]}}else J.includes(o.name)?(s&&l&&(r==null||r.contents.push(s.replace(/\s+/gu," ")),s=""),o.childNodes.forEach(d)):W.includes(o.name)&&o.childNodes.forEach(d);else o.type==="text"?s+=o.data.trim()?o.data:"":a&&!n&&o.type==="comment"&&o.data.trim()==="more"&&(l=!1)},y=G.parseHTML(e.contentRendered),k=v(i.map(({getter:o},g)=>{const p=o(e);return M(p)?[g.toString(),p]:p?[g.toString(),[p]]:null}).filter(o=>o!==null));return!(y!=null&&y.length)&&!x(k).length?null:(y==null||y.forEach(o=>{d(o)}),l&&s&&(r==null||r.contents.push(s)),r.contents.length&&t.contents.push(r),{...t,...x(k).length?{customFields:k}:{}})},L=(e,i)=>{const n=e.pages.map(a=>{const t=z(a,i.customFields,i.indexContent);return t?{path:a.path,index:t,localePath:a.pathLocale}:null}).filter(a=>a!==null);return v(x({"/":{},...e.options.locales}).map(a=>[a,v(n.filter(t=>t.localePath===a).map(t=>[t.path,t.index]))]))},X=8192,Q=async(e,i)=>{const n=e.dir.dest(i.worker||"search-pro.worker.js"),a=JSON.stringify(L(e,i)),t=a.length>X,l=`${K}${t?"minify":"original"}.js`,s=await b.readFile(l,"utf8");await b.ensureDir(w.dirname(n)),await b.writeFile(n,s.replace("SEARCH_PRO_INDEX",`${JSON.stringify(t?f(a):a)}`))},Y={"/en/":{cancel:"Cancel",placeholder:"Search",search:"Search",searching:"Searching",select:"to select",navigate:"to navigate",exit:"to exit",history:"Search History",emptyHistory:"Empty Search History",emptyResult:"No results found",loading:"Loading search indexes..."},"/zh/":{cancel:"å–æ¶ˆ",placeholder:"æœç´¢",search:"æœç´¢",searching:"æœç´¢ä¸­",select:"é€‰æ‹©",navigate:"åˆ‡æ¢",exit:"å…³é—­",history:"æœç´¢åŽ†å²",emptyHistory:"æ— æœç´¢åŽ†å²",emptyResult:"æ²¡æœ‰æ‰¾åˆ°ç»“æžœ",loading:"æ­£åœ¨åŠ è½½æœç´¢ç´¢å¼•..."},"/zh-tw/":{cancel:"å–æ¶ˆ",placeholder:"æœç´¢",search:"æœç´ ",searching:"æœç´¢ä¸­",select:"é¸æ“‡",navigate:"åˆ‡æ›",exit:"é—œé–‰",history:"æœç´¢æ­·å²",emptyHistory:"ç„¡æœç´¢æ­·å²",emptyResult:"æ²’æœ‰æ‰¾åˆ°çµæžœ",loading:"æ­£åœ¨åŠ è¼‰æœç´¢ç´¢å¼•..."},"/de/":{cancel:"Abbrechen",placeholder:"Suche",search:"Suche",searching:"Suche",select:"auswÃ¤hlen",navigate:"wechseln",exit:"schlieÃŸen",history:"Suchverlauf",emptyHistory:"Suchverlauf leeren",emptyResult:"Keine Ergebnisse gefunden",loading:"Suchindex wird geladen..."},"/de-at/":{cancel:"Abbrechen",placeholder:"Suche",search:"Suche",searching:"Suche",select:"auswÃ¤hlen",navigate:"wechseln",exit:"schlieÃŸen",history:"Suchverlauf",emptyHistory:"Suchverlauf leeren",emptyResult:"Keine Ergebnisse gefunden",loading:"Suchindex wird geladen..."},"/vi/":{cancel:"Há»§y",placeholder:"TÃ¬m kiáº¿m",search:"TÃ¬m kiáº¿m",searching:"Äang tÃ¬m kiáº¿m",select:"chá»n",navigate:"chuyá»ƒn",exit:"Ä‘Ã³ng",history:"Lá»‹ch sá»­ tÃ¬m kiáº¿m",emptyHistory:"XÃ³a lá»‹ch sá»­ tÃ¬m kiáº¿m",emptyResult:"KhÃ´ng tÃ¬m tháº¥y káº¿t quáº£",loading:"Äang táº£i chá»‰ má»¥c tÃ¬m kiáº¿m..."},"/uk/":{cancel:"Ð¡ÐºÐ°ÑÑƒÐ²Ð°Ñ‚Ð¸",placeholder:"ÐŸÐ¾ÑˆÑƒÐº",search:"ÐŸÐ¾ÑˆÑƒÐº",searching:"ÐŸÐ¾ÑˆÑƒÐº",select:"Ð²Ð¸Ð±Ñ€Ð°Ñ‚Ð¸",navigate:"Ð¿ÐµÑ€ÐµÐ¹Ñ‚Ð¸",exit:"Ð·Ð°ÐºÑ€Ð¸Ñ‚Ð¸",history:"Ð†ÑÑ‚Ð¾Ñ€Ñ–Ñ Ð¿Ð¾ÑˆÑƒÐºÑƒ",emptyHistory:"ÐžÑ‡Ð¸ÑÑ‚Ð¸Ñ‚Ð¸ Ñ–ÑÑ‚Ð¾Ñ€Ñ–ÑŽ Ð¿Ð¾ÑˆÑƒÐºÑƒ",emptyResult:"ÐÑ–Ñ‡Ð¾Ð³Ð¾ Ð½Ðµ Ð·Ð½Ð°Ð¹Ð´ÐµÐ½Ð¾",loading:"Ð—Ð°Ð²Ð°Ð½Ñ‚Ð°Ð¶ÐµÐ½Ð½Ñ Ð¿Ð¾ÑˆÑƒÐºÐ¾Ð²Ð¸Ñ… Ñ–Ð½Ð´ÐµÐºÑÑ–Ð²..."},"/ru/":{cancel:"ÐžÑ‚Ð¼ÐµÐ½Ð°",placeholder:"ÐŸÐ¾Ð¸ÑÐº",search:"ÐŸÐ¾Ð¸ÑÐº",searching:"ÐŸÐ¾Ð¸ÑÐº",select:"Ð²Ñ‹Ð±Ñ€Ð°Ñ‚ÑŒ",navigate:"Ð¿ÐµÑ€ÐµÐºÐ»ÑŽÑ‡Ð¸Ñ‚ÑŒ",exit:"Ð·Ð°ÐºÑ€Ñ‹Ñ‚ÑŒ",history:"Ð˜ÑÑ‚Ð¾Ñ€Ð¸Ñ Ð¿Ð¾Ð¸ÑÐºÐ°",emptyHistory:"ÐžÑ‡Ð¸ÑÑ‚Ð¸Ñ‚ÑŒ Ð¸ÑÑ‚Ð¾Ñ€Ð¸ÑŽ Ð¿Ð¾Ð¸ÑÐºÐ°",emptyResult:"ÐÐ¸Ñ‡ÐµÐ³Ð¾ Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½Ð¾",loading:"Ð—Ð°Ð³Ñ€ÑƒÐ·ÐºÐ° Ð¿Ð¾Ð¸ÑÐºÐ¾Ð²Ñ‹Ñ… Ð¸Ð½Ð´ÐµÐºÑÐ¾Ð²..."},"/br/":{cancel:"Cancelar",placeholder:"Pesquisar",search:"Pesquisar",searching:"Pesquisando",select:"selecionar",navigate:"navegar",exit:"fechar",history:"HistÃ³rico de pesquisa",emptyHistory:"Limpar histÃ³rico de pesquisa",emptyResult:"Nenhum resultado encontrado",loading:"Carregando Ã­ndices de pesquisa..."},"/pl/":{cancel:"Anuluj",placeholder:"Szukaj",search:"Szukaj",searching:"Szukanie",select:"wybierz",navigate:"przejdÅº",exit:"zamknij",history:"Historia wyszukiwania",emptyHistory:"WyczyÅ›Ä‡ historiÄ™ wyszukiwania",emptyResult:"Nie znaleziono wynikÃ³w",loading:"Åadowanie indeksÃ³w wyszukiwania..."},"/sk/":{cancel:"ZruÅ¡iÅ¥",placeholder:"HÄ¾adaÅ¥",search:"HÄ¾adaÅ¥",searching:"HÄ¾adanie",select:"vybraÅ¥",navigate:"prepnÃºÅ¥",exit:"zavrieÅ¥",history:"HistÃ³ria vyhÄ¾adÃ¡vania",emptyHistory:"VymazaÅ¥ histÃ³riu vyhÄ¾adÃ¡vania",emptyResult:"NenaÅ¡li sa Å¾iadne vÃ½sledky",loading:"NaÄÃ­tavajÃº sa vyhÄ¾adÃ¡vacie indexy..."},"/fr/":{cancel:"Annuler",placeholder:"Rechercher",search:"Rechercher",searching:"Recherche",select:"sÃ©lectionner",navigate:"naviguer",exit:"fermer",history:"Historique de recherche",emptyHistory:"Vider l'historique de recherche",emptyResult:"Aucun rÃ©sultat trouvÃ©",loading:"Chargement des index de recherche..."},"/es/":{cancel:"Cancelar",placeholder:"Buscar",search:"Buscar",searching:"Buscando",select:"seleccionar",navigate:"navegar",exit:"cerrar",history:"Historial de bÃºsqueda",emptyHistory:"Vaciar historial de bÃºsqueda",emptyResult:"No se encontraron resultados",loading:"Cargando Ã­ndices de bÃºsqueda..."},"/ja/":{cancel:"ã‚­ãƒ£ãƒ³ã‚»ãƒ«",placeholder:"æ¤œç´¢",search:"æ¤œç´¢",searching:"æ¤œç´¢ä¸­",select:"é¸æŠž",navigate:"åˆ‡ã‚Šæ›¿ãˆ",exit:"é–‰ã˜ã‚‹",history:"æ¤œç´¢å±¥æ­´",emptyHistory:"æ¤œç´¢å±¥æ­´ã‚’ã‚¯ãƒªã‚¢",emptyResult:"çµæžœãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“",loading:"æ¤œç´¢ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’èª­ã¿è¾¼ã‚“ã§ã„ã¾ã™..."},"/tr/":{cancel:"Ä°ptal",placeholder:"Ara",search:"Ara",searching:"AranÄ±yor",select:"seÃ§",navigate:"geÃ§",exit:"kapat",history:"Arama geÃ§miÅŸi",emptyHistory:"Arama geÃ§miÅŸini temizle",emptyResult:"SonuÃ§ bulunamadÄ±",loading:"Arama dizinleri yÃ¼kleniyor..."},"/ko/":{cancel:"ì·¨ì†Œ",placeholder:"ê²€ìƒ‰",search:"ê²€ìƒ‰",searching:"ê²€ìƒ‰ ì¤‘",select:"ì„ íƒ",navigate:"ì´ë™",exit:"ë‹«ê¸°",history:"ê²€ìƒ‰ ê¸°ë¡",emptyHistory:"ê²€ìƒ‰ ê¸°ë¡ ì§€ìš°ê¸°",emptyResult:"ê²°ê³¼ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤",loading:"ê²€ìƒ‰ ì¸ë±ìŠ¤ë¥¼ ë¡œë“œí•˜ëŠ” ì¤‘..."},"/fi/":{cancel:"Peruuta",placeholder:"Etsi",search:"Etsi",searching:"EtsitÃ¤Ã¤n",select:"valitaksesi",navigate:"navigoidaksesi",exit:"poistuaksesi",history:"Hakuhistoria",emptyHistory:"TyhjennÃ¤ hakuhistoria",emptyResult:"Tuloksia ei lÃ¶ytynyt",loading:"Ladataan hakuindeksiÃ¤..."},"/hu/":{cancel:"MÃ©gse",placeholder:"KeresÃ©s",search:"KeresÃ©s",searching:"KeresÃ©s",select:"kivÃ¡lasztÃ¡shoz",navigate:"navigÃ¡lÃ¡shoz",exit:"kilÃ©pÃ©shez",history:"KeresÃ©si elÅ‘zmÃ©nyek",emptyHistory:"Ãœres keresÃ©si elÅ‘zmÃ©nyek",emptyResult:"Nincs talÃ¡lat",loading:"A keresÃ©si indexek betÃ¶ltÃ©se..."},"/id/":{cancel:"Batal",placeholder:"Cari sesuatu ðŸ”Ž",search:"Cari",searching:"Sedang mencari",select:"pilih",navigate:"navigasi",exit:"keluar",history:"Riwayat Penelusuran",emptyHistory:"Tidak ada riwayat penelusuran",emptyResult:"Hasil penelusuran tidak tersedia",loading:"Memuat indeks penelusuran..."},"/nl/":{cancel:"Annuleren",placeholder:"Zoeken",search:"Zoeken",searching:"Zoeken",select:"Selecteren",navigate:"to navigate",exit:"to exit",history:"Zoekgeschiedenis",emptyHistory:"Zoekgeschiedenis Leegmaken",emptyResult:"Geen resultaten gevonden",loading:"Laden van zoekindexen..."}},H=`
if (import.meta.webpackHot) {
  import.meta.webpackHot.accept()
  if (__VUE_HMR_RUNTIME__.updateSearchProDatabase)
    __VUE_HMR_RUNTIME__.updateSearchProDatabase(database)
}

if (import.meta.hot) {
  import.meta.hot.accept(({ database }) => {
    __VUE_HMR_RUNTIME__.updateSearchProDatabase(database);
  })
}
`;let h=null;const R=async(e,i)=>{if(e.env.isDev){const n=L(e,i);h=n;const a=`export const database = "${f(JSON.stringify(n))}";

${H}
`;await e.writeTemp("search-pro/database.js",a)}},N=async(e,i,n)=>{if(h){const a=n.replace(/^pages\//,"").replace(/\/index\.html\.vue/,"/readme.md").replace(/\.html\.vue/,".md"),{env:t,pages:l,writeTemp:s}=e,r=l.find(({filePathRelative:c})=>(c==null?void 0:c.toLowerCase())===a.toLowerCase());if(r){const c=z(r,i.customFields,i.indexContent);if(c){h[r.pathLocale][r.path]=c;let d=`export const database = "${f(JSON.stringify(h))}"
`;t.isDev&&(d+=H),await s("search-pro/database.js",d);return}}}await R(e,i)},ee=async(e,i,n)=>{if(h){const a=n.replace(/^pages\//,"").replace(/\/index\.html\.vue/,"/readme.md").replace(/\.html\.vue/,".md"),{env:t,pages:l,writeTemp:s}=e,r=l.find(({filePathRelative:c})=>(c==null?void 0:c.toLowerCase())===a.toLowerCase());if(r){delete h[r.pathLocale][r.path];let c=`export const database = "${f(JSON.stringify(h))}"
`;t.isDev&&(c+=H),await s("search-pro/database.js",c);return}}await R(e,i)},ae=(e,i=!0)=>n=>(i&&V(e),A(n,{id:"hope"}),q(n,m,"2.0.0-beta.61"),n.env.isDebug&&P.info("Options:",e),{name:m,alias:{[`${m}/result`]:`${C}components/SearchResult.js`},define:{SEARCH_PRO_CUSTOM_FIELDS:v((e.customFields||[]).map(({formatter:a},t)=>a?[t.toString(),a]:null).filter(a=>a!==null)),SEARCH_PRO_LOCALES:I({app:n,name:m,config:e.locales,default:Y}),SEARCH_PRO_OPTIONS:{delay:e.delay||300,queryHistoryCount:e.queryHistoryCount||5,resultHistoryCount:e.resultHistoryCount||5,hotKeys:e.hotKeys||[{key:"k",ctrl:!0}],worker:e.worker||"search-pro.worker.js"}},clientConfigFile:`${C}config.js`,extendsBundlerOptions:(a,t)=>{T(a,t,["fflate","vuepress-shared"])},onInitialized:a=>Z(a),onPrepared:a=>R(a,e),onWatched:(a,t)=>{if("hotReload"in e?e.hotReload:a.env.isDebug){const l=O("pages/**/*.vue",{cwd:a.dir.temp(),ignoreInitial:!0});l.on("add",s=>{N(a,e,s)}),l.on("change",s=>{N(a,e,s)}),l.on("unlink",s=>{ee(a,e,s)}),t.push(l)}},onGenerated:a=>Q(a,e)});export{ae as searchProPlugin};
//# sourceMappingURL=index.js.map
