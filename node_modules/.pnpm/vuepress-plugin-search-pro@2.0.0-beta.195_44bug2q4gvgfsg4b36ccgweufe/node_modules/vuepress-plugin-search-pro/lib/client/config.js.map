{"version":3,"file":"config.js","sources":["../../src/client/composables/setup.ts","../../src/client/utils/isFocusingTextControl.ts","../../src/client/utils/isKeyMatched.ts","../../src/client/utils/keys.ts","../../src/client/components/SearchBox.ts","../../src/client/components/SearchModal.ts","../../src/client/config.ts"],"sourcesContent":["import { type InjectionKey, type Ref, provide, ref } from \"vue\";\n\nexport const searchModalSymbol: InjectionKey<Ref<boolean>> =\n  Symbol.for(\"search-pro\");\n\nexport const setupSearchModal = (): void => {\n  const isActive = ref(false);\n\n  provide(searchModalSymbol, isActive);\n};\n","/**\n * Determines whether the user is currently focusing a text control.\n * In this case, the search plugin shouldn’t hijack any hotkeys because\n * the user might be typing into a text field, using type-ahead search\n * in a `select` element, etc.\n */\nexport const isFocusingTextControl = (target: EventTarget): boolean => {\n  if (!(target instanceof Element)) return false;\n\n  return (\n    document.activeElement === target &&\n    ([\"TEXTAREA\", \"SELECT\", \"INPUT\"].includes(target.tagName) ||\n      target.hasAttribute(\"contenteditable\"))\n  );\n};\n","import { searchProHotKeys } from \"../define.js\";\n\nexport const isKeyMatched = (event: KeyboardEvent): boolean =>\n  searchProHotKeys.some((item) => {\n    const {\n      key,\n      ctrl = false,\n      shift = false,\n      alt = false,\n      meta = false,\n    } = item;\n\n    return (\n      key === event.key &&\n      ctrl === event.ctrlKey &&\n      shift === event.shiftKey &&\n      alt === event.altKey &&\n      meta === event.metaKey\n    );\n  });\n","export const ENTER_KEY =\n  '<svg width=\"15\" height=\"15\" aria-label=\"Enter key\" role=\"img\"><g fill=\"none\" stroke=\"currentColor\" stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"1.2\"><path d=\"M12 3.53088v3c0 1-1 2-2 2H4M7 11.53088l-3-3 3-3\"></path></g></svg>';\n\nexport const DOWN_KEY =\n  '<svg width=\"15\" height=\"15\" aria-label=\"Arrow down\" role=\"img\"><g fill=\"none\" stroke=\"currentColor\" stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"1.2\"><path d=\"M7.5 3.5v8M10.5 8.5l-3 3-3-3\"></path></g></svg>';\n\nexport const UP_KEY =\n  '<svg width=\"15\" height=\"15\" aria-label=\"Arrow up\" role=\"img\"><g fill=\"none\" stroke=\"currentColor\" stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"1.2\"><path d=\"M7.5 11.5v-8M10.5 6.5l-3-3-3 3\"></path></g></svg>';\n\nexport const ESC_KEY =\n  '<svg width=\"15\" height=\"15\" aria-label=\"Escape key\" role=\"img\"><g fill=\"none\" stroke=\"currentColor\" stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"1.2\"><path d=\"M13.6167 8.936c-.1065.3583-.6883.962-1.4875.962-.7993 0-1.653-.9165-1.653-2.1258v-.5678c0-1.2548.7896-2.1016 1.653-2.1016.8634 0 1.3601.4778 1.4875 1.0724M9 6c-.1352-.4735-.7506-.9219-1.46-.8972-.7092.0246-1.344.57-1.344 1.2166s.4198.8812 1.3445.9805C8.465 7.3992 8.968 7.9337 9 8.5c.032.5663-.454 1.398-1.4595 1.398C6.6593 9.898 6 9 5.963 8.4851m-1.4748.5368c-.2635.5941-.8099.876-1.5443.876s-1.7073-.6248-1.7073-2.204v-.4603c0-1.0416.721-2.131 1.7073-2.131.9864 0 1.6425 1.031 1.5443 2.2492h-2.956\"></path></g></svg>';\n","import { useEventListener } from \"@vueuse/core\";\nimport {\n  type VNode,\n  computed,\n  defineComponent,\n  h,\n  inject,\n  onMounted,\n  ref,\n} from \"vue\";\nimport {\n  checkIsIOS,\n  checkIsMacOS,\n  checkIsiPad,\n  useLocaleConfig,\n} from \"vuepress-shared/client\";\n\nimport { SearchIcon } from \"./icons.js\";\nimport { searchModalSymbol } from \"../composables/index.js\";\nimport { searchProHotKeys, searchProLocales } from \"../define.js\";\nimport { isFocusingTextControl, isKeyMatched } from \"../utils/index.js\";\n\nimport \"../styles/search-box.scss\";\n\nconst primaryKey = searchProHotKeys[0];\n\nexport default defineComponent({\n  name: \"SearchBox\",\n\n  setup() {\n    const locale = useLocaleConfig(searchProLocales);\n    const isActive = inject(searchModalSymbol)!;\n    const isMacOS = ref(false);\n\n    const controlKeys = computed(() =>\n      primaryKey\n        ? [\n            ...(isMacOS.value\n              ? [\"⌃\", \"⇧\", \"⌥\", \"⌘\"]\n              : [\"Ctrl\", \"Shift\", \"Alt\", \"Win\"]\n            ).filter(\n              (_, index) =>\n                primaryKey[([\"ctrl\", \"shift\", \"alt\", \"meta\"] as const)[index]]\n            ),\n            primaryKey.key.toUpperCase(),\n          ]\n        : null\n    );\n\n    const onKeydown = (event: KeyboardEvent): void => {\n      if (\n        // not active\n        !isActive.value &&\n        // key matches\n        isKeyMatched(event) &&\n        // event does not come from the search box itself or\n        // user isn't focusing (and thus perhaps typing in) a text control\n        !isFocusingTextControl(event.target as EventTarget)\n      ) {\n        event.preventDefault();\n        isActive.value = true;\n      }\n    };\n\n    useEventListener(\"keydown\", onKeydown);\n\n    onMounted(() => {\n      const { userAgent } = navigator;\n\n      isMacOS.value =\n        checkIsMacOS(userAgent) ||\n        checkIsIOS(userAgent) ||\n        checkIsiPad(userAgent);\n    });\n\n    return (): (VNode | null)[] => [\n      h(\n        \"button\",\n        {\n          class: \"search-pro-button\",\n          role: \"search\",\n          \"aria-label\": locale.value.search,\n          onClick: () => {\n            isActive.value = true;\n          },\n        },\n        [\n          h(SearchIcon),\n          h(\"div\", { class: \"placeholder\" }, locale.value.search),\n          controlKeys.value\n            ? h(\n                \"div\",\n                { class: \"key-hints\" },\n                controlKeys.value.map((key) => h(\"kbd\", { class: \"key\" }, key))\n              )\n            : null,\n        ]\n      ),\n    ];\n  },\n});\n","import { useSiteLocaleData } from \"@vuepress/client\";\nimport { useEventListener, useScrollLock } from \"@vueuse/core\";\nimport {\n  type VNode,\n  defineAsyncComponent,\n  defineComponent,\n  h,\n  inject,\n  nextTick,\n  onMounted,\n  onUnmounted,\n  ref,\n  watch,\n} from \"vue\";\nimport { useIsMobile, useLocaleConfig } from \"vuepress-shared/client\";\n\nimport { SearchLoading } from \"./SearchLoading.js\";\nimport { SearchIcon } from \"./icons.js\";\nimport {\n  searchModalSymbol,\n  useSearchQueryHistory,\n} from \"../composables/index.js\";\nimport { searchProLocales } from \"../define.js\";\nimport { DOWN_KEY, ENTER_KEY, ESC_KEY, UP_KEY } from \"../utils/index.js\";\n\nimport \"../styles/search-modal.scss\";\n\nconst SearchResult = defineAsyncComponent({\n  loader: () =>\n    import(\n      /* webpackChunkName: \"search-pro-result\" */ \"vuepress-plugin-search-pro/result\"\n    ),\n  loadingComponent: () => {\n    const localeConfig = useLocaleConfig(searchProLocales);\n\n    return h(SearchLoading, { hint: localeConfig.value.loading });\n  },\n});\n\nexport default defineComponent({\n  name: \"SearchModal\",\n\n  setup() {\n    const isActive = inject(searchModalSymbol)!;\n    const siteLocale = useSiteLocaleData();\n    const isMobile = useIsMobile();\n    const locale = useLocaleConfig(searchProLocales);\n    const { enabled, queryHistory } = useSearchQueryHistory();\n\n    const input = ref(\"\");\n    const inputElement = ref<HTMLInputElement>();\n\n    const body = ref<HTMLElement>();\n    const isLocked = useScrollLock(body);\n\n    watch(isActive, (value) => {\n      if (value)\n        void nextTick().then(() => {\n          inputElement.value?.focus();\n        });\n    });\n\n    useEventListener(\"keydown\", (event: KeyboardEvent) => {\n      if (isActive.value && event.key === \"Escape\") isActive.value = false;\n    });\n\n    onMounted(() => {\n      body.value = document.body;\n\n      watch(isActive, (value) => {\n        isLocked.value = value;\n      });\n    });\n\n    onUnmounted(() => {\n      isLocked.value = false;\n    });\n\n    return (): VNode | null =>\n      isActive.value\n        ? h(\"div\", { class: \"search-pro-modal-wrapper\" }, [\n            h(\"div\", {\n              class: \"background\",\n              onClick: () => {\n                isActive.value = false;\n                input.value = \"\";\n              },\n            }),\n            h(\"div\", { class: \"search-pro-modal\" }, [\n              h(\"div\", { class: \"search-pro-box\" }, [\n                h(\"form\", [\n                  h(\n                    \"label\",\n                    { for: \"search-pro\", \"aria-label\": locale.value.search },\n                    h(SearchIcon)\n                  ),\n                  h(\"input\", {\n                    ref: inputElement,\n                    type: \"search\",\n                    class: \"search-pro-input\",\n                    id: \"search-pro\",\n                    placeholder: locale.value.placeholder,\n                    spellcheck: \"false\",\n                    autocapitalize: \"off\",\n                    autocorrect: \"off\",\n                    autocomplete: enabled ? \"on\" : \"off\",\n                    name: `${siteLocale.value.title}-search`,\n                    list: \"search-pro-dataset\",\n                    value: input.value,\n                    \"aria-controls\": \"search-pro-results\",\n                    onInput: ({ target }: InputEvent) => {\n                      input.value = (<HTMLInputElement>target).value;\n                    },\n                  }),\n                  h(\n                    \"dataset\",\n                    { id: \"search-pro-dataset\" },\n                    queryHistory.value.map((item) =>\n                      h(\"options\", { value: item })\n                    )\n                  ),\n                ]),\n                h(\n                  \"button\",\n                  {\n                    class: \"close-button\",\n                    onClick: () => {\n                      isActive.value = false;\n                      input.value = \"\";\n                    },\n                  },\n                  locale.value.cancel\n                ),\n              ]),\n\n              h(SearchResult, {\n                query: input.value,\n                onClose: () => {\n                  isActive.value = false;\n                },\n                onUpdateQuery: (query: string) => {\n                  input.value = query;\n                },\n              }),\n\n              // key hints should only appears in pc\n              isMobile.value\n                ? null\n                : h(\"div\", { class: \"search-pro-hints\" }, [\n                    h(\"span\", { class: \"search-pro-hint\" }, [\n                      h(\"kbd\", { innerHTML: ENTER_KEY }),\n                      locale.value.select,\n                    ]),\n                    h(\"span\", { class: \"search-pro-hint\" }, [\n                      h(\"kbd\", { innerHTML: UP_KEY }),\n                      h(\"kbd\", { innerHTML: DOWN_KEY }),\n                      locale.value.navigate,\n                    ]),\n                    h(\"span\", { class: \"search-pro-hint\" }, [\n                      h(\"kbd\", { innerHTML: ESC_KEY }),\n                      locale.value.exit,\n                    ]),\n                  ]),\n            ]),\n          ])\n        : null;\n  },\n});\n","import { defineClientConfig } from \"@vuepress/client\";\n\nimport SearchBox from \"./components/SearchBox.js\";\nimport SearchModal from \"./components/SearchModal.js\";\nimport { setupSearchModal } from \"./composables/index.js\";\n\nexport default defineClientConfig({\n  enhance({ app }) {\n    app.component(\"SearchBox\", SearchBox);\n  },\n  setup() {\n    setupSearchModal();\n  },\n  rootComponents: [SearchModal],\n});\n"],"names":["searchModalSymbol","setupSearchModal","isActive","ref","provide","isFocusingTextControl","target","isKeyMatched","event","searchProHotKeys","item","key","ctrl","shift","alt","meta","ENTER_KEY","DOWN_KEY","UP_KEY","ESC_KEY","primaryKey","defineComponent","locale","useLocaleConfig","searchProLocales","inject","isMacOS","controlKeys","computed","_","index","useEventListener","onMounted","userAgent","checkIsMacOS","checkIsIOS","checkIsiPad","h","SearchIcon","SearchResult","defineAsyncComponent","localeConfig","SearchLoading","siteLocale","useSiteLocaleData","isMobile","useIsMobile","enabled","queryHistory","useSearchQueryHistory","input","inputElement","body","isLocked","useScrollLock","watch","value","nextTick","_a","onUnmounted","query","config","defineClientConfig","app","SearchBox","SearchModal"],"mappings":"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"}